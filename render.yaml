services:
  # 1. MySQL Database (Private Service)
  - type: pserv
    name: parkease-db
    plan: free
    runtime: docker
    image:
      url: mysql:8.0
    disk:
      name: parkease-db-data
      mountPath: /var/lib/mysql
      sizeGB: 1
    envVars:
      - key: MYSQL_ROOT_PASSWORD
        fromGroup: parkease-secrets
      - key: MYSQL_DATABASE
        fromGroup: parkease-secrets
      - key: MYSQL_USER
        fromGroup: parkease-secrets
      - key: MYSQL_PASSWORD
        fromGroup: parkease-secrets

  # 2. Spring Boot Backend
  - type: web
    name: parkease-backend
    plan: free
    runtime: docker
    region: ohio
    dockerContext: ./parkease-api
    dockerfilePath: ./parkease-api/Dockerfile
    envVars:
      - key: SPRING_DATASOURCE_URL
        value: jdbc:mysql://parkease-db:3306/${MYSQL_DATABASE}
      - key: SPRING_DATASOURCE_USERNAME
        fromGroup: parkease-secrets
      - key: SPRING_DATASOURCE_PASSWORD
        fromGroup: parkease-secrets
      - key: MYSQL_DATABASE
        fromGroup: parkease-secrets
      - key: APP_JWT_SECRET
        fromGroup: parkease-secrets
      - key: SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_CLIENT_ID
        fromGroup: parkease-secrets
      - key: SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_CLIENT_SECRET
        fromGroup: parkease-secrets
      - key: RADAR_API_KEY
        fromGroup: parkease-secrets

  # 3. React Frontend
  - type: web
    name: parkease-frontend
    plan: free
    region: ohio
    runtime: docker
    dockerContext: ./parkease-frontend
    dockerfilePath: ./parkease-frontend/Dockerfile
    envVars:
      - key: VITE_API_BASE
        value: /api
      - key: VITE_RADAR_PUBLISHABLE_KEY
        fromGroup: parkease-secrets
      - key: VITE_GOOGLE_CLIENT_ID
        fromGroup: parkease-secrets

# --- Environment Group ---
envVarGroups:
  - name: parkease-secrets
